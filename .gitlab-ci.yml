image: python:3.9

services:
  - postgres:13.2

variables:
  POSTGRES_DB: invoice_engine_database

# This folder is cached between builds
cache:
  paths:
    - ~/.cache/pip/

test: 
    services:
      - postgres:13.2
    variables:
      POSTGRES_DB: invoice_engine_database
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    script:
      - export DATABASE_URL=postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@postgres:5432/$POSTGRES_DB
      - apt-get update -qy
      - apt-get install -y python3-dev python3-pip
      - pip install -r requirements.txt
      - python manage.py test